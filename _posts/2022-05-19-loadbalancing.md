---
toc: true
title: "로드벨런싱을 통한 요청 분산"
category:
    - CS
---

스마트폰이 보급화되고 인터넷 발달로 인해 서비스에 들어오는 트래픽이 폭발적으로 증가했습니다.

아무리 좋은 성능의 서버여도 한 대의 서버로 모든 트래픽을 감당하는것은 어려워졌습니다.

때문에 서버를 추가로 구비하고 여러 대의 서버에 동일한 데이터를 저장해 수많은 트래픽을 효과적으로 분산하여 처리하는 방식으로 증가한 트래픽을 처리하게 되었습니다.

하지만 단순히 서버를 여러대 구축해서 운영하더라도 모든 클라이언트의 요청에 일관성 있게 응답할 수 있는것은 아닙니다. 트래픽을 여러 대의 서버로 적절하게 분산시켜서 하나의 서버에 트래픽이 몰리는 상황을 예방해야만 합니다.

이때 필요한 기술이 바로 로드 밸런싱입니다.

## Load Balancing

![Untitled](https://i.imgur.com/1yfWeZW.png)

<center><small> 출처 - https://networkencyclopedia.com/load-balancing/</small></center>

<br>

`로드 밸런싱`이란 요청을 여러 서버로 나누어서 처리하는것을 의미합니다.

한 대의 서버에 부하가 집중되지 않도록 트래픽을 분산시켜서 각각의 서버가 최적의 성능을 
보장할 수 있도록 하는 것을 목적으로 합니다.

이용자 수가 증가하고 서비스의 규모가 커지면 기존의 서버만으로는 트래픽을 감당하는게 
불가능하게 되고, 두가지 방법을 통해서 트래픽 문제를 해결하게 됩니다.

1. Scale-Up : 기존 서버의 성능을 확장하는 방식
2. Scale-Out : 기존의 서버와 동일하거나 낮은 성능의 서버를 여러대 증설하는 방식

만약 Scale-Out 방식으로 서버를 증설하였다면 트래픽을 균등하게 분배해주기 위한 로드 
밸런싱이 필요합니다.

## 다양한 로드 밸런싱 알고리즘

### 라운드로빈

클라이언트의 요청을 **순서대로 분배**합니다.

여러 대의 서버가 **동일한 스펙**을 갖고있고 서버와의 연결이 오래 지속되지 않는 경우에 
활용하기 적합합니다.

### 가중 라운드로빈

각각의 서버마다 가중치를 매기고 가중치가 높은 서버에 요청을 우선적으로 배분합니다.

서버의 트래픽 처리 능력이 상이한 경우 사용하는 방식입니다.

A라는 서버가 8가중치를 갖고, B 서버는 4가중치를 갖는다면 로드 밸런서는 라운드로빈 
방식으로 A 서버에 8개, B 서버에 4개의 요청을 전달합니다.

### IP 해시

클라이언트의 IP 주소와 특정 서버를 매핑하여 특정 IP의 요청만을 담당해서 처리하는 
방식입니다.

사용자가 항상 동일한 서버로 연결되는 것을 보장합니다.

### 최소 연결 방식

요청이 들어온 시점에 가장 적은 연결 상태의 서버에 우선적으로 트래픽을 배분합니다.

세션이 길어지거나 서버에 분배된 트래픽들이 일정하지 않은 경우에 적합합니다.

### 최소 응답 시간 방식 $($ 성능 )

가장 적은 연결 상태와 가장 짧은 응답 시간을 보이는 서버에 우선적으로 요청을 배분하는 
방식입니다.

서버의 현재 연결 상태와 응답 시간을 고려합니다.

$($응답 시간 : 서버에 요청을 보내고 최초 응답을 받을 때까지 소요되는 시간)

## L4, L7 로드 밸런싱

L4 로드 밸런싱은 Layer 4 $($전송 계층) 프로토콜의 헤더를 부하 분산에 이용합니다.

모든 요청을 L4 로드 밸런서가 전송 계층에서 받아 서버들에게 배분하게 됩니다.

이때 L4 로드 밸런서는 네트워크 계층이나 전송 계층 $($TCP, UDP)의 정보$($IP 주소, 
포트번호, MAC 주소)를 바탕으로 요청을 분산합니다.

L7 로드 밸런싱 또한 Layer 7 $($응용 계층) 프로토콜의 헤더를 부하 분산에 이용합니다.

애플리케이션 계층에서 요청을 분산하기 때문에 HTTP 헤더, 쿠키 등과 같은 사용자의 
요청을 기준으로 **특정 서버에 트래픽을 분산하는 것이 가능**합니다.

즉, 패킷의 내용에 따라 요청을 특정 서버에 분배하는 것이 가능하기 때문에 URL에 따라 
부하를 분산시키거나 HTTP 헤더의 쿠키 값에 따라 부하를 분산 시키는 등, 클라리언트의 
요청을 보다 세분화해서 서버에 전달할 수 있습니다.

뿐만 아니라 L7 로드 밸런서의 경우 특정한 패턴의 바이러스를 감지해 네트워크를 보호할 수 
있으며 DoS/DDoS와 같은 비정상적인 트래픽을 필터링하는 것도 가능하기 때문에 네트워크 
보안 분야에서 사용되고 있습니다.

**참고 자료**

[https://tecoble.techcourse.co.kr/post/2021-11-07-load-balancing/](https://tecoble.techcourse.co.kr/post/2021-11-07-load-balancing/)